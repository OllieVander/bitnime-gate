<!DOCTYPE html>
<html>
<head>
  <title>Ledger Syndicate Vault</title>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
</head>

<body style="background:black;color:white;text-align:center;padding-top:120px;font-family:sans-serif;">

  <h1>Ledger Syndicate Vault</h1>

  <div id="ton-connect"></div>
  <br><br>

  <div id="status">Connect your wallet to continue.</div>

  <div id="secret" style="display:none;margin-top:40px;">
    <h2>Access Granted</h2>
    <p>Your exclusive TON address:</p>
    <p style="color:cyan;font-size:20px;">
      UQCGqczbK4sr2QCJWtUQsJRjedjKfmpdj_atpL8S3Q_PUPX6
    </p>
  </div>

  <script>
    // This is the EXACT collection format your TON API returned in your screenshot:
    const COLLECTION_RAW = "0:b509366380a4a4806fffea815b8befeb445b8c535bc67b0529698a5f5782b43a";

    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
      manifestUrl: "https://ton-connect.github.io/demo-dapp-with-react-ui/tonconnect-manifest.json",
      buttonRootId: "ton-connect"
    });

    function normalize(addr) {
      return String(addr || "").trim().toLowerCase();
    }

    tonConnectUI.onStatusChange(async (wallet) => {
      if (!wallet) return;

      const address = wallet.account.address;
      document.getElementById("status").innerText = "Checking ownership...";

      try {
        const response = await fetch(`https://tonapi.io/v2/accounts/${address}/nfts`);
        const data = await response.json();

        const nftItems = data?.nft_items || [];
        const collectionsFound = nftItems
          .map(nft => nft?.collection?.address)
          .filter(Boolean)
          .map(normalize);

        const ownsNFT = collectionsFound.includes(normalize(COLLECTION_RAW));

        if (ownsNFT) {
          document.getElementById("status").innerText = "";
          document.getElementById("secret").style.display = "block";
        } else {
          document.getElementById("status").innerText =
            "You do not own a Ledger Syndicate NFT.";
        }

      } catch (err) {
        document.getElementById("status").innerText =
          "Error checking ownership.";
      }
    });
  </script>

</body>
</html>
