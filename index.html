<!DOCTYPE html>
<html>
<head>
  <title>Ledger Syndicate Vault</title>
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
</head>

<body style="background:black;color:white;text-align:center;padding-top:100px;font-family:sans-serif;">

  <h1>Ledger Syndicate Vault</h1>

  <div id="ton-connect"></div>
  <br><br>

  <div id="status" style="white-space:pre-wrap;">Connect your wallet to continue.</div>

  <div id="secret" style="display:none;margin-top:40px;">
    <h2>Access Granted</h2>
    <p>Your exclusive TON address:</p>
    <p style="color:cyan;font-size:20px;">
      UQCGqczbK4sr2QCJWtUQsJRjedjKfmpdj_atpL8S3Q_PUPX6
    </p>
  </div>

  <script>
    // The collection from your GetGems URL
    const COLLECTION_FRIENDLY = "EQC1CTZjgKSkgG__6oFbi-_rRFuMU1vGewUpaYpfV4K0OtMj";

    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
      manifestUrl: "https://ton-connect.github.io/demo-dapp-with-react-ui/tonconnect-manifest.json",
      buttonRootId: "ton-connect"
    });

    tonConnectUI.onStatusChange(async (wallet) => {
      if (!wallet) return;

      const address = wallet.account.address;
      document.getElementById("status").innerText = "Connected wallet:\n" + address + "\n\nChecking NFTs...";

      try {
        const response = await fetch(`https://tonapi.io/v2/accounts/${address}/nfts`);
        const data = await response.json();

        const nftItems = data?.nft_items || [];
        const collectionsFound = nftItems
          .map(nft => nft?.collection?.address)
          .filter(Boolean);

        // DEBUG OUTPUT (this is what we need to see)
        document.getElementById("status").innerText =
          "Connected wallet:\n" + address +
          "\n\nNFTs found: " + nftItems.length +
          "\n\nCollections returned by TON API (first 10):\n" +
          (collectionsFound.slice(0, 10).join("\n") || "(none)");

        // Ownership check: match using the exact string TON API returns
        const ownsNFT = collectionsFound.includes(COLLECTION_FRIENDLY);

        if (ownsNFT) {
          document.getElementById("secret").style.display = "block";
        } else {
          document.getElementById("status").innerText +=
            "\n\nResult: NOT a holder (based on collection match).";
        }

      } catch (err) {
        document.getElementById("status").innerText =
          "Error checking ownership.\n\n" + err;
      }
    });
  </script>

</body>
</html>
